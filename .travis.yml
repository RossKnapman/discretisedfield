sudo: required

before_install:
  - npm install --save-dev travis-after-all

services:
  - docker

install:
  - docker build -t dockertestimage .

script:
  - ci_env=`bash <(curl -s https://codecov.io/env)`
  - docker run -e ci_env -ti -d --name testcontainer dockertestimage
  - docker exec testcontainer make travis-build
  - docker stop testcontainer
  - docker rm testcontainer

after_script:
  - |
      declare exitCode;
      $(npm bin)/travis-after-all
      exitCode=$?
      if [ "$exitCode" -eq 0 ]; then
        body='{
        "request": {
          "branch":"master"
        }}'

        curl -s -X POST \
        -H "Content-Type: application/json" \
        -H "Accept: application/json" \
        -H "Travis-API-Version: 3" \
        -H "Authorization: token $TRAVIS_ACCESS_TOKEN" \
        -d "$body" \
        https://api.travis-ci.org/repo/joommf%2Fjoommftools/requests
      fi
      
notifications:
  slack: joommf:eqKxGPXuUP3LxnOfxg7GWgDF
